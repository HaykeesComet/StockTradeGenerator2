<!-- result.ejs -->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Stock Trade Results</title>
  <link href="/style3.css" rel="stylesheet">
</head>
<body>
  <div class="container">
    <h1 style="font-size:38px; font-family:'Courier New'" align='center'>üíµ $tock Trade Generator</h1>
    <h2 style="font-size:28px; font-family:'Courier New'" align='center'>For Top Best Performing Stocks Right Now</h2>

    <p align='center'>‚ñë‚ñí‚ñì‚ñà ‚ñë‚ñí‚ñì‚ñà‚ñì‚ñí‚ñë‚ñí‚ñì‚ñà‚ñì‚ñí‚ñë‚ñí‚ñì</p>
    <p align="center"><img src="/Stock.jpg" width="605" height="454" alt="Stock Image"></p>
    <p align='center'>‚ñë‚ñí‚ñì‚ñà ‚ñë‚ñí‚ñì‚ñà‚ñì‚ñí‚ñë‚ñí‚ñì‚ñà‚ñì‚ñí‚ñë‚ñí‚ñì</p>

    <h3 style="font-size:20px; font-family:'Courier New'"><center>You're total initial capital is <%= capital %> USD.</center></h3>
    <% stockPrices.forEach(function(stock) { %>
      <p><center>Current price for '<i><%= stock.name %></i>' is <b><%= stock.price %></b>.</center></p>
    <% }); %>

    <center>üíª</center>

    <h3 style="font-size:20px; font-family:'Courier New'"><center>Amounts for Robinhood</center></h3>
    <% investments.forEach(function(investment) { %>
      <p><i><center>Amount to 'BUY' for <b><%= investment.name %></b> is <mark><b><u><%= investment.amount.toFixed(2) %></u></b></mark>.</center></i></p>
    <% }); %>

    <center>üì≤</center>

    <h3 style="font-size:20px; font-family:'Courier New'"><center>Shares for E*TRADE</center></h3>
    <p><i><center>Number of equal shares to 'BUY' for
      <% stockPrices.forEach(function(stock, index) { %>
        <b><%= stock.name %></b><% if (index < stockPrices.length - 1) { %>, <% } %>
      <% }); %>
      is <mark><b><u><%= shareBuyAverage %></u></b></mark> 'each'.</center></i></p>

    <h4 style="font-size:16px; font-family:'Courier New'"><b><center>‚òû Note that if you get a <i>0</i>, that means <i><u>INCALCULABLE</u></i>. ‚òú</center></b></h4>

    <h3><center>‚∞Ü‚ïë ‚µà ‚µà ‚µà ‚µà ‚µà ‚µà‚ïë‚∞Ü</center></h3>
    <p align="center"><img src="/Horn.jpg" width="648" height="432" alt="Horn Image"></p>

    <h3 style="font-size:18px; font-family:'Courier New'" align="center">‚òù Just for checking purposes, you're total invested amount for all <%= stockPrices.length %> stocks in 'Robinhood' is <%= totalInvestmentAmount.toFixed(2) %> USD. Or, if using 'E*TRADE', then your total invested amount for all <%= stockPrices.length %> stocks is <%= totalAmountShares.toFixed(2) %> USD.</h3>

    <h3 style="font-size:18px; font-family:'Courier New'"><center>ü•ß You're slice of the pie from your 'Total Investment Capital' down below:</center></h3>
    <% percentages.forEach(function(percentage) { %>
      <h4 style="font-size:18px; font-family:'Courier New'" align="center">‚ú± <%= percentage.name %> comprises <%= percentage.percent %> %</h4>
    <% }); %>

    <h2 style="font-size:22px; font-family:'Courier New'"><center>Good Luck! <%= name %> <div class="chum">(‚ñ∞Àò‚ó°Àò‚ñ∞)</div></center></h2>

    <div align='center' style="margin: 20px 0;">
      <button onclick="printPage()" style="margin: 5px; padding: 2px;">üñ®Ô∏è Print Page</button>
      <button onclick="saveAsImage()" style="margin: 5px; padding: 2px;">üì∑ Save as Image</button>
    </div>

    <div align='center' style="margin: 10px 0;">
      <button onclick="document.location='/'" style="margin: 5px;">üëã Start Over</button>
    </div>
  </div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <script>
    function printPage() {
      window.print();
    }

    function saveAsImage() {
      const element = document.querySelector('.container');
      const options = {
        backgroundColor: '#ffffff',
        scale: 2,
        useCORS: true,
        allowTaint: true,
        scrollX: 0,
        scrollY: 0,
        width: element.scrollWidth,
        height: element.scrollHeight
      };

      html2canvas(element, options).then(function(canvas) {
        // Create download link
        const link = document.createElement('a');
        link.download = 'stock-trade-results-<%= name %>.png';
        link.href = canvas.toDataURL('image/png');

        // Trigger download
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
      }).catch(function(error) {
        console.error('Error generating image:', error);
        alert('Error saving image. Please try again or use the print function.');
      });
    }
  </script>
</body>
</html>
